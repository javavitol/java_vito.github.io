<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="MQ(Message Queue) 消息队列，是基础数据结构中先进先出的一种数据结构。指把要传输的数据(消息)放在队列中，用队列机制来实现消息传递。">
    

    <!--Author-->
    
        <meta name="author" content="Vito">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="MQ初识"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content=""/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    
        <meta name="twitter:card" content="summary" />
    
    
    

    <!-- Title -->
    
    <title>MQ初识 - </title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/vitoblog/css/style.css">


    <!-- Google Analytics -->
    


<meta name="generator" content="Hexo 6.3.0"></head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/vitoblog/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/vitoblog/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/vitoblog/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/vitoblog/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/vitoblog/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/vitoblog/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/vitoblog/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/vitoblog/2023/02/03/MQ%E5%88%9D%E8%AF%86/">
                MQ初识
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2023-02-03</span>
            
            
            
                <span class="category">
                    <a href="/vitoblog/categories/MQ系列/">MQ系列</a>
                </span>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <p>MQ(Message Queue) 消息队列，是基础数据结构中先进先出的一种数据结构。指把要传输的数据(消息)放在队列中，用队列机制来实现消息传递。</p>
<span id="more"></span>
<h3 id="MQ-消息队列-种类"><a href="#MQ-消息队列-种类" class="headerlink" title="MQ(消息队列)种类"></a>MQ(消息队列)种类</h3><table>
    <tr>
       <th></th>
       <th>RabbitMQ</th>
       <th>ActiveMQ</th>
       <th>RocketMQ</th>
       <th>Kafka</th>
    </tr>
    <tr>
        <td>公司/社区</td>
        <td>Rabbit</td>
        <td>Apache</td>
        <td>alibaba</td>
        <td>Apache</td>
    </tr>
    <tr>
        <td>开发语言</td>
        <td>Erlang</td>
        <td>java</td>
        <td>java</td>
        <td>scala&java</td>
    </tr>
    <tr>
        <td>协议支持</td>
        <td>AMQP，XMPP,SMTP,STOMP</td>
        <td>OpenWire,STOMP,REST,XMPP,AMQP</td>
        <td>自定义协议</td>
        <td>自定义协议</td>
    </tr>
    <tr>
        <td>可用性</td>
        <td>高</td>
        <td>一般</td>
        <td>高</td>
        <td>高</td>
    </tr>
    <tr>
        <td>单机吞吐量</td>
        <td>一般</td>
        <td>差</td>
        <td>高</td>
        <td>非常高</td>
    </tr>
    <tr>
        <td>消息延迟</td>
        <td>微秒级</td>
        <td>毫秒级</td>
        <td>毫秒级</td>
        <td>毫秒以内</td>
    </tr>
    <tr>
        <td>消息可靠性</td>
        <td>高</td>
        <td>一般</td>
        <td>高</td>
        <td>一般</td>
    </tr>
</table>

<h3 id="RocketMQ-详解"><a href="#RocketMQ-详解" class="headerlink" title="RocketMQ 详解"></a>RocketMQ 详解</h3><ol>
<li>普通消息： 普通消息是指消息队列RocketMQ 中普通特性的消息， 区别于有特性的定时和延时消息，顺序消息和事务消息。</li>
<li>定时和延时消息：</li>
</ol>
<ol>
<li>定时消息： Producer将消息发送到消息队列RocketMQ服务端，但并不期望立马投递这条消息，而是推迟到当前时间点之后的某一个时间投递到Consumer进行消费，该消息即定时消息。</li>
<li>延时消息： Producer将消息发送到消息队列RocketMQ服务端，但并不期望立马投递这条消息，而是延迟一定时间后才投递到Consumer进行消费，该消息即延时消息。</li>
</ol>
<ol start="3">
<li>顺序消息： 顺序消息可以保证消息的消费顺序和发送顺序一致，即先发送的先消费，后发送的后消费，常用于金融证券、电子商务。为了保证消息的顺序性，只支持可靠的同步发送方式，不支持异步。</li>
<li>事务消息：消息队列RocketMQ版提供类似XA或Open XA的分布式事务功能，通过消息队列RocketMQ版事务消息能达到分布式事务的最终一致。<ol>
<li>半事务消息： 消息队列RocketMQ版提供类似XA或Open XA的分布式事务功能，通过消息队列RocketMQ版事务消息能达到分布式事务的最终一致。</li>
<li>消息回查： 由于网络闪断、生产者应用重启等原因，导致某条事务消息的二次确认丢失，消息队列RocketMQ版服务端通过扫描发现某条消息长期处于“半事务消息”时，需要主动向消息生产者询问该消息的最终状态（Commit或是Rollback），该询问过程即消息回查。</li>
</ol>
</li>
<li>集群消费和广播消费：<ol>
<li>集群消费： 当使用集群消费模式时，消息队列RocketMQ版认为任意一条消息只需要被集群内的任意一个消费者处理即可。</li>
<li>广播消费: 当使用广播消费模式时，消息队列RocketMQ版会将每条消息推送给集群内所有的消费者，保证消息至少被每个消费者消费一次。</li>
</ol>
</li>
<li>批量消费：当使用广播消费模式时，消息队列RocketMQ版会将每条消息推送给集群内所有的消费者，保证消息至少被每个消费者消费一次。</li>
</ol>
<h4 id="RocketMQ-角色介绍"><a href="#RocketMQ-角色介绍" class="headerlink" title="RocketMQ 角色介绍"></a>RocketMQ 角色介绍</h4><ol>
<li>producer： 生产者，主要用于发送消息</li>
<li>NameServer： 管理broker信息，producer会先调用NameServer，查询Broker信息，然后Producer再发送给Broker</li>
<li>Broker： 接收producer的消息，上报自己信息给NameServer</li>
<li>Consumer： 链接NameServer，查询Broker信息，然后从Broker获取对应队列，接收信息</li>
<li>Topic： 区分消息种类，一个发送者可以发送信息给一个或者多个Topic，一个消息的接受者可以订阅一个或多个Topic</li>
<li>Message Queue： 相当于是Topic的分区，用于并行发送和接收消息</li>
</ol>
<h4 id="RocketMQ-集群特定"><a href="#RocketMQ-集群特定" class="headerlink" title="RocketMQ 集群特定"></a>RocketMQ 集群特定</h4><ol>
<li>NameServer是一个几乎无状态节点，可集群搭建，节点之间无任何信息同步</li>
<li>Broker部署复杂，Broker分为master和slave，一个Master可以对应多个Slave，但是一个Slave只能对应一个Master，Master和Slave的对应关系通过指定相同的BrokerName，不同的BrokerId来定义，BrokerId&#x3D;0表示Master，非0表示Slave，Master也可以部署多个，每个Broker与NameServer集群中的所有节点建立长链接，定时注册Topic信息到所有的NameServer</li>
<li>Producer与NameServer集群中的其中一个节点建立长链接，定期从NameServer取Topic路由信息，并向提供Topic服务的Master建立长链接，定时向Master发送心跳，Producer完全无状态，可集群部署。</li>
<li>Consumer与NameServer集群中一个节点建立长链接，定期从NameServer取Topic路由信息，并向提供Topic服务的Master，Slave建立长链接，定期发送心跳。Consumer既可以从Master订阅消息，也可以从Slave订阅信息，订阅规则由Broker配置决定。</li>
</ol>
<h4 id="RocketMQ-集群模式"><a href="#RocketMQ-集群模式" class="headerlink" title="RocketMQ 集群模式"></a>RocketMQ 集群模式</h4><ol>
<li>单Master模式： 这种方式风险较大，一旦Broker重启或者宕机，会导致整个服务不可用，线上一般不会使用</li>
<li>多Master模式： 一个集群无Slave，全是Master，这种模式优缺点：<br> (1)优点：配置简单，当个master宕机或重启维护对应用无影响，性能最高<br> (2)缺点：单台机器宕机期间，这台机器上未被消费的消息在机器恢复之前不可订阅，消息实时性会受影响。</li>
<li>多Master多Slave模式(异步)： 每个master配置一个Slave，有多对Master-Slave，HA采用异步复制方式，主备有短暂消息延迟（毫秒级），这种模式的优缺点如下：<br> (1)优点：即使磁盘损坏，消息丢失非常少，且消息实时性不会受影响，同时Master宕机后，消费者仍然可以从Slave消费，而且此过程对应用透明，不需要人工干预，性能同多Master模式几乎一样。<br> (2)缺点：master宕机，磁盘损坏情况下会丢失少量信息</li>
<li>多Master多Slave模式(同步)： 每个master配置一个Slave，有多对Master-Slave，HA 采用同步双写方式，即只有主备都写成功，才向应用返回成功，这种模式的优缺点：<br> (1)优点：数据与服务无单点故障，Master宕机情况下，消息无延迟，服务可用性与数据可用性非常高<br> (2)缺点：性能比异步复制模式略低，发送单个消息的RT会高点，且目前版本再主节点宕机后，备机不能自动切换为主机。</li>
</ol>

    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/vitoblog/tags/MessageQueue/">#MessageQueue</a>
        </div>
    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a href="https://github.com/klugjo">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/vitoblog/2023/02/07/k8s-pod%E6%8E%A7%E5%88%B6%E5%99%A8/">k8s-pod控制器</a>
            </li>
            
            <li>
                <a class="footer-post" href="/vitoblog/2023/02/07/k8s-label/">k8s-label</a>
            </li>
            
            <li>
                <a class="footer-post" href="/vitoblog/2023/02/07/k8s-pod/">k8s-pod</a>
            </li>
            
            <li>
                <a class="footer-post" href="/vitoblog/2023/02/07/k8s-namespace/">k8s-namespace</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>Categories</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/vitoblog/categories/hexo/">hexo</a>
        </li>
        
        <li>
            <a class="footer-post" href="/vitoblog/categories/jenkins/">jenkins</a>
        </li>
        
        <li>
            <a class="footer-post" href="/vitoblog/categories/MQ%E7%B3%BB%E5%88%97/">MQ系列</a>
        </li>
        
        <li>
            <a class="footer-post" href="/vitoblog/categories/springcloud%E7%B3%BB%E5%88%97/">springcloud系列</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://telegram.org/">
                            <span class="footer-icon-container">
                                <i class="fa fa-telegram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://500px.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:test@example.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a target="_blank" rel="noopener" href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->

<script src="/vitoblog/js/main.js"></script>


<!-- Disqus Comments -->



</body>

</html>